<!DOCTYPE html>
<html lang="en">
<head>
    <title>jk-js - Examples</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.min.css">
    <script src="lib/d3/d3.min.js" charset="utf-8"></script>
    <script src="jkjs/path.js" charset="utf-8"></script>
    <script src="jkjs/effects.js" charset="utf-8"></script>
    <script src="jkjs/text.js" charset="utf-8"></script>
    <script src="jkjs/busy.js" charset="utf-8"></script>
    <script src="jkjs/zui.js" charset="utf-8"></script>
    <style type="text/css">
        .centeredBlock {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body onload="start()">
    <div class="container">
        <div class="row">
            <div class="col-md-9" role="main">
                <div id="divFilter"></div>
                <div id="divPattern"></div>
                <div id="divText"></div>
                <div id="divBusyZUI"></div>
            </div>
            <div class="col-md-3">
                <div class="hidden-print hidden-xs hidden-sm affix" role="complementary">
                    <ul id="navigation" class="nav"></ul>
                </div>
            </div>
        </div>
    </div>
<script>
function filterExample(sel) {
    var w = 100;
    var h = 50;
    var cix = 0;
    var colors = [ null,  "white", "crimson", "cornflowerblue" ];
    var svgFilter = sel.append("svg").style({
        "width": w+"px",
        "height": h+"px"
    }).on("click", function() {
        cix = (cix + 1) % colors.length;
        rect.style({
            "fill": colors[cix]
        });
    }).classed("centeredBlock", true);
    var rect = svgFilter.append("rect").attr({
        "x": 0,
        "y": 0,
        "width": w,
        "height": h
    });
    svgFilter.append("text").attr({
        "x": w * 0.5,
        "y": (h + 10) * 0.5,
        "filter": jkjs.effects.getBlurFilter(svgFilter, 6)
    }).style({
        "text-anchor": "middle",
        "fill": "black",
        "-moz-user-select": "none",
        "-webkit-user-select": "none",
        "-ms-user-select": "none",
        "user-select": "none"
    }).text("Click Me!");
    svgFilter.append("rect").attr({
        "x": 0,
        "y": 0,
        "width": w,
        "height": h
    }).style({
        "fill": "none",
        "stroke": "black"
    });
}

function patternExample(sel) {
    var w = 100;
    var h = 50;
    var coolness = false;
    var svgPattern = sel.append("svg").style({
        "width": w+"px",
        "height": h+"px"
    }).on("click", function() {
        coolness = !coolness;
        pathSel.attr({
            "filter": coolness ? jkjs.effects.getBlurFilter(svgPattern, 2) : null
        });
    }).classed("centeredBlock", true);
    var path = new jkjs.Path();
    var htap = new jkjs.Path();
    var pos = 0;
    path.move(0, 20);
    var delta = 10;
    var tw = 100 + delta;
    var y1 = 10;
    var y2 = 20;
    var y3 = 30;
    var y4 = 40;
    while(pos < tw) {
        path.quad(pos, y1, pos + delta, y1);
        htap.quad(tw - pos, y4, tw - pos - delta, y4);
        pos += 2*delta;
        path.quad(pos, y1, pos, y2);
        htap.quad(tw - pos, y4, tw - pos, y3);
    }
    path.add(htap);
    path.close();
    var pathSel = svgPattern.append("path").attr({
        "d": path,
        "stroke": "black",
        "fill": jkjs.effects.getStripePattern(svgPattern, d3.rgb("crimson"), 23)
    });
    svgPattern.append("rect").attr({
        "x": 0,
        "y": 0,
        "width": w,
        "height": h
    }).style({
        "fill": "none",
        "stroke": "black"
    });
}

function textWrapExample(sel) {
    var w = 500;
    var h = 250;
    var longText = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, "
                 + "sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. "
                 + "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris "
                 + "nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in "
                 + "reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla "
                 + "pariatur. Excepteur sint occaecat cupidatat non proident, sunt in "
                 + "culpa qui officia deserunt mollit anim id est laborum.";
    var shortText = "This is a short text.";
    var splitX = w * 0.6;
    var splitY = h;
    var clamp = function(val, hor) {
        return Math.min(Math.max(val, 0), hor ? w : h);
    };
    var updatePos = function() {
        var pos = d3.mouse(svgText.node());
        splitX = clamp(pos[0], true);
        splitY = clamp(pos[1], false);
        updateText();
    };
    var svgText = sel.append("svg").classed("centeredBlock", true).style({
        width: w + "px",
        height: h + "px"
    }).on("mousemove", updatePos).on("mouseout", updatePos);
    var rectFull = svgText.append("rect").style({
        "fill": "none",
        "stroke": "black"
    }).attr({
        x: 0,
        y: 0,
        width: w,
        height: h
    });
    var txtLeft = svgText.append("text");
    var rectLeft = svgText.append("rect").style({
        "fill": "none",
        "stroke": "black"
    });
    var txtRight = svgText.append("text");
    var rectRight = svgText.append("rect").style({
        "fill": "none",
        "stroke": "black"
    });
    var updateText = function() {
        var boxL = {
            x: 0,
            y: 0,
            width: splitX,
            height: splitY
        };
        jkjs.text.display(txtLeft, longText, boxL, true);
        rectLeft.attr(boxL);
        var boxR = {
            x: splitX,
            y: 0,
            width: w - splitX,
            height: splitY
        };
        jkjs.text.display(txtRight, shortText, boxR, false, jkjs.text.align.right);
        rectRight.attr(boxR);
    };
    updateText();
}

function busyZUIExample(sel) {
    var div = sel.append("div").style({
        "display": "flex",
        "align-items": "center",
        "justify-content": "center"
    });
    var w = 200;
    var h = 100;
    // ZUI
    var zui = jkjs.zui.create(div, {
        width: w + "px",
        height: h + "px"
    }, {
        width: w,
        height: h
    }, function() {
        return box;
    }, function(target, translate, scale) {
        target.attr('transform', 'translate(' + translate + ') scale(' + scale + ')');
    });
    var box = {
        x: 20,
        y: 10,
        width: 60,
        height: 40
    };
    var inner = zui.inner;
    inner.append("circle").attr({
        "cx": 30,
        "cy": 20,
        "r": 10
    }).style({
        "fill": "cornflowerblue",
        "stroke": "black"
    });
    inner.append("rect").attr({
        "x": 60,
        "y": 30,
        "width": 20,
        "height": 20
    }).style({
        "fill": "crimson",
        "stroke": "black"
    });
    zui.svg.append("rect").attr({
        "x": 0,
        "y": 0,
        "width": w,
        "height": h
    }).style({
        "fill": "none",
        "stroke": "black"
    });
    zui.showAll(false);
    // busy
    var busy = new jkjs.busy.layer(zui.svg, {
        x: 0,
        y: 0,
        width: w,
        height: h
    });
    var btnClass = {
        "btn": true,
        "btn-default": true
    };
    var btnAttr = {
        "type": "button"
    };

    function onClick(state, btn) {
        return function() {
            busy.setState(state);
            btnNorm.classed("active", btnNorm === btn);
            btnBusy.classed("active", btnBusy === btn);
            btnWarn.classed("active", btnWarn === btn);
        }
    }

    var btns = div.append("div").classed({
        "btn-group-vertical": true,
        "btn-group-sm": true
    }).style({
        "margin": "5px"
    });
    var btnNorm = btns.append("button").text("normal").attr(btnAttr).classed("active", true);
    btnNorm.classed(btnClass).on("click", onClick(jkjs.busy.state.norm, btnNorm));
    var btnBusy = btns.append("button").text("busy").attr(btnAttr);
    btnBusy.classed(btnClass).on("click", onClick(jkjs.busy.state.busy, btnBusy));
    var btnWarn = btns.append("button").text("warning").attr(btnAttr);
    btnWarn.classed(btnClass).on("click", onClick(jkjs.busy.state.warn, btnWarn));
}

function start() {
    function addExample(id, title, example) {
        var sel = d3.select(id);
        sel.append("h3").text(title);
        var panel = sel.append("div").classed({
            "panel": true,
            "panel-default": true
        });
        var body = panel.append("div").classed("panel-body", true).style({
            "position": "relative"
        });
        example(body);
        var code = null;
        body.append("span").classed({
            "btn": true,
            "btn-xs": true
        }).style({
            "position": "absolute",
            "right": 0,
            "bottom": 0
        }).text("View Source").on("click", function() {
            if(code) {
                code.remove();
                code = null;
                return;
            }
            code = panel.append("div").classed("panel-footer", true);
            code.append("pre").append("code").text(example.toString());
        });
        var li = d3.select("#navigation").append("li");
        li.append("a").attr({
            "href": id
        }).text(title);
    }

    addExample("#divFilter", "Blur Filter", filterExample);
    addExample("#divPattern", "Fill Pattern", patternExample);
    addExample("#divText", "Text Flow", textWrapExample);
    addExample("#divBusyZUI", "ZUI and Busy Layer", busyZUIExample);
}
</script>

</body>
</html>
