<!DOCTYPE html>
<html lang="en">
<head>
    <title>Test jk-js</title>
    <meta charset="utf-8">
    <script src="lib/d3/d3.min.js" charset="utf-8"></script>
    <script src="path.js" charset="utf-8"></script>
    <script src="effects.js" charset="utf-8"></script>
    <script src="text.js" charset="utf-8"></script>
    <script src="busy.js" charset="utf-8"></script>
    <script src="zui.js" charset="utf-8"></script>
    <style>
        body {
            font-family: "PT Sans", Helvetica, Arial, sans-serif;
        }

        #filterText {
            text-anchor: middle;
            fill: black;
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body onload="start()">
    <div>
        <svg id="svgFilter" style="width: 100px; height: 50px;">
            <rect x="0" y="0" width="100" height="50" />
            <text x="50" y="30" id="filterText">Click Me!</text>
        </svg>
        <svg id="svgPattern" style="width: 100px; height: 50px;">
            <path id="patternPath"/>
        </svg>
    </div>
    <div>
        <svg id="svgText" />
    </div>
    <div id="divBusy"></div>
<script>
function filterTest() {
    var cix = 0;
    var colors = [ null,  "white", "crimson", "cornflowerblue" ];
    var svgFilter = d3.select("#svgFilter").on("click", function() {
        cix = (cix + 1) % colors.length;
        svgFilter.selectAll("rect").style({
            "fill": colors[cix]
        });
    });
    d3.select("#filterText").attr({
        "filter": jkjs.effects.getBlurFilter(svgFilter, 6)
    });
}

function patternTest() {
    var coolness = false;
    var svgPattern = d3.select("#svgPattern").on("click", function() {
        coolness = !coolness;
        d3.select("#patternPath").attr({
            "filter": coolness ? jkjs.effects.getBlurFilter(svgPattern, 2) : null
        });
    });
    var path = new jkjs.Path();
    var htap = new jkjs.Path();
    var pos = 0;
    path.move(0, 20);
    var delta = 10;
    var w = 100 + delta;
    var y1 = 10;
    var y2 = 20;
    var y3 = 30;
    var y4 = 40;
    while(pos < w) {
        path.quad(pos, y1, pos + delta, y1);
        htap.quad(w - pos, y4, w - pos - delta, y4);
        pos += 2*delta;
        path.quad(pos, y1, pos, y2);
        htap.quad(w - pos, y4, w - pos, y3);
    }
    path.add(htap);
    path.close();
    d3.select("#patternPath").attr({
        "d": path,
        "stroke": "black",
        "fill": jkjs.effects.getStripePattern(svgPattern, d3.rgb("crimson"), 23)
    });
}

function textWrapTest() {
    var w = 500;
    var h = 250;
    var longText = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, "
                 + "sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. "
                 + "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris "
                 + "nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in "
                 + "reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla "
                 + "pariatur. Excepteur sint occaecat cupidatat non proident, sunt in "
                 + "culpa qui officia deserunt mollit anim id est laborum.";
    var shortText = "This is a short text.";
    var splitX = w * 0.6;
    var splitY = h;
    var clamp = function(val, hor) {
        return Math.min(Math.max(val, 0), hor ? w : h);
    };
    var updatePos = function() {
        var pos = d3.mouse(svgText.node());
        splitX = clamp(pos[0], true);
        splitY = clamp(pos[1], false);
        updateText();
    };
    var svgText = d3.select("#svgText").style({
        width: w + "px",
        height: h + "px"
    }).on("mousemove", updatePos).on("mouseout", updatePos);
    var rectFull = svgText.append("rect").style({
        "fill": "none",
        "stroke": "black"
    }).attr({
        x: 0,
        y: 0,
        width: w,
        height: h
    });
    var txtLeft = svgText.append("text");
    var rectLeft = svgText.append("rect").style({
        "fill": "none",
        "stroke": "black"
    });
    var txtRight = svgText.append("text");
    var rectRight = svgText.append("rect").style({
        "fill": "none",
        "stroke": "black"
    });
    var updateText = function() {
        var boxL = {
            x: 0,
            y: 0,
            width: splitX,
            height: splitY
        };
        jkjs.text.display(txtLeft, longText, boxL, true);
        rectLeft.attr(boxL);
        var boxR = {
            x: splitX,
            y: 0,
            width: w - splitX,
            height: splitY
        };
        jkjs.text.display(txtRight, shortText, boxR, false, jkjs.text.align.right);
        rectRight.attr(boxR);
    };
    updateText();
}

function busyAndZUITest() {
    var w = 200;
    var h = 100;
    var b = d3.select("#divBusy");
    // ZUI
    var zui = jkjs.zui.create(b, {
        width: w + "px",
        height: h + "px"
    }, {
        width: w,
        height: h
    }, function() {
        return box;
    }, function(target, translate, scale) {
        target.attr('transform', 'translate(' + translate + ') scale(' + scale + ')');
    });
    var box = {
        x: 20,
        y: 10,
        width: 60,
        height: 40
    };
    var s = zui.svg;
    var inner = zui.inner;
    inner.append("circle").attr({
        "cx": 30,
        "cy": 20,
        "r": 10
    }).style({
        "fill": "cornflowerblue",
        "stroke": "black"
    });
    inner.append("rect").attr({
        "x": 60,
        "y": 30,
        "width": 20,
        "height": 20
    }).style({
        "fill": "crimson",
        "stroke": "black"
    });
    s.append("rect").attr({
        "x": 0,
        "y": 0,
        "width": w,
        "height": h
    }).style({
        "fill": "none",
        "stroke": "black"
    });
    zui.showAll(false);
    // busy
    var busy = new jkjs.busy.layer(s, {
        x: 0,
        y: 0,
        width: w,
        height: h
    });
    b.append("span").on("click", function() {
        busy.setState(busy.state.norm);
    }).text("normal");
    b.append("span").on("click", function() {
        busy.setState(busy.state.busy);
    }).text("busy");
    b.append("span").on("click", function() {
        busy.setState(busy.state.warn);
    }).text("warning");
}

function start() {
    filterTest();
    patternTest();
    textWrapTest();
    busyAndZUITest();
}
</script>

</body>
</html>
